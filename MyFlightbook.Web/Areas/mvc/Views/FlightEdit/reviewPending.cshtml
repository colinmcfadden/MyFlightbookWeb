@using System.Globalization
@{
    ViewBag.defaultTab = tabID.tabLogbook;
    ViewBag.Title = Resources.LogbookEntry.ReviewPendingFlightsHeader;
    Layout = "~/Areas/mvc/Views/Shared/_Layout.cshtml";
    MyFlightbook.Profile viewer = ViewBag.viewer;
    IEnumerable<PendingFlight> rgpf = ViewBag.pendingFlights;
    LogbookEntry pfSelected = ViewBag.pendingFlight;
}
<script type="text/javascript" src="@("~/Public/Scripts/flightedit.js?v=1".ToAbsolute())"></script>
<script type="text/javascript">
    function deletePendingFlight(pfID) {
        $("#hdnPendingID").val(pfID);
        var f = $("#frmActPending").serialize();
        $.ajax({
            url: "@Url.Action("DeletePendingFlight", "FlightEdit")",
            type: "POST", data: f, dataType: "text", contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            error: function (xhr, status, error) { window.alert(xhr.responseText); },
            complete: function () { },
            success: function () {
                window.location = '@Request.Url.AbsoluteUri';
            }
        });
        return false;
    }

    function deleteAllPendingFlights() {
        $("#hdnPendingID").val('');
        var f = $("#frmActPending").serialize();
        $.ajax({
            url: "@Url.Action("DeleteAllPendingFlights", "FlightEdit")",
            type: "POST", data: f, dataType: "text", contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            error: function (xhr, status, error) { window.alert(xhr.responseText); },
            complete: function () { },
            success: function () {
                window.location = '@Request.Url.AbsoluteUri';
            }
        });
        return false;
    }

    function cancelEdit() {
        window.location = '@("~/mvc/FlightEdit/PendingFlights".ToAbsolute())';
        return false;
    }

    function flightSaved() {
        window.location = '@("~/mvc/FlightEdit/PendingFlights".ToAbsolute())';
        return false;
    }
</script>
@if (pfSelected != null)
{
    Html.RenderAction("FlightEditor", "FlightEdit", new { targetUser = User.Identity.Name, le = pfSelected, onCancel = ViewBag.onCancel, onSave = ViewBag.onSave, nextFlightHref = ViewBag.nextFlightHref, prevFlightHref = ViewBag.prevFlightHref });
}
else
{
    <p>@Resources.LogbookEntry.ReviewPendingFlightsPrompt</p>
    using (Html.BeginForm("", "FlightEdit", FormMethod.Post, new { id = "frmActPending", name = "frmActPending" }))
    {
        <input type="hidden" name="pfID" id="hdnPendingID" value="" />
        @Html.AntiForgeryToken()
    }
    if (!rgpf.Any())
    {
        <ul><li>@Resources.LogbookEntry.ReviewPendingFlightsNoFlights</li></ul>
    }
    else
    {
        <input type="hidden" id="hdnLastSortDir" value="desc" />
        <input type="hidden" id="hdnSortIndex" value="0" />
        <table class="lbTable" id="tblPending">
            <thead>
                <tr class="gvhDefault" style="vertical-align: bottom">
                    <th class="headerBase headerSortDesc gvhLeft" style="text-align: left;" onclick="javascript: sortTable(this, 0, 'date', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldFlight</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 1, '', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldTail</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 2, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldApproaches</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 3, '', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldHold</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 4, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldLanding</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 5, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldXCountry</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 6, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldNight</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 7, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Html.Raw(Resources.LogbookEntry.FieldSimIMC)</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 8, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldIMC</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 9, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Html.Raw(Resources.LogbookEntry.FieldGroundSim)</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 10, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldDual</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 11, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldCFI</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 12, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldSIC</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 13, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldPIC</th>
                    <th class="headerBase gvhCentered" onclick="javascript: sortTable(this, 14, 'num', 'hdnSortIndex', 'hdnLastSortDir');">@Resources.LogbookEntry.FieldTotal</th>
                    <th class="noprint"></th>
                    <th class="noprint"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (PendingFlight pf in rgpf)
                {
                    <tr class="logbookRow logbookRowEven">
                        <td class="gvcLeft">
                            <span style="display:none">@pf.Date.YMDString()</span>
                            <div>
                                <a href="@String.Format(CultureInfo.InvariantCulture, "{0}/{1}", Request.Url.AbsolutePath, pf.PendingID)" style="font-weight: bold; font-size: larger">@pf.Date.ToShortDateString()</a>
                                <span style="font-weight: bold">@pf.Route</span>
                                <div style="clear: left; white-space: pre-line;" dir="auto">@Html.Raw(ApproachDescription.ReplaceApproaches(pf.Comment.Linkify()))</div>
                            </div>
                            <div>
                                @if (viewer.DisplayTimesByDefault)
                                {
                                    <div>@LogbookEntryDisplay.FormatEngineTime(pf.EngineStart, pf.EngineEnd, viewer.UsesUTCDateOfFlight, viewer.UsesHHMM)</div>
                                    <div>@LogbookEntryDisplay.FormatFlightTime(pf.FlightStart, pf.FlightEnd, viewer.UsesUTCDateOfFlight, viewer.UsesHHMM)</div>
                                    <div>@LogbookEntryDisplay.FormatHobbs(pf.HobbsStart, pf.HobbsEnd)</div>
                                }
                            </div>
                            <div>
                                @foreach (string s in CustomFlightProperty.PropDisplayAsList(pf.CustomProperties, viewer.UsesHHMM, true, true))
                                {
                                    <div>@s</div>
                                }
                            </div>
                        </td>
                        <td class="gvcCentered">@pf.TailNumDisplay</td>
                        <td class="gvcCentered">@pf.Approaches.FormatInt()<span style="display:none">@pf.Approaches.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@Html.Raw(pf.fHoldingProcedures.FormatBoolean())</td>
                        <td class="gvcCentered">@LogbookEntryDisplay.LandingDisplayForFlight(pf)<span style="display:none">@pf.Landings.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.CrossCountry.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.CrossCountry.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.Nighttime.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.Nighttime.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.SimulatedIFR.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.SimulatedIFR.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.IMC.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.IMC.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.GroundSim.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.GroundSim.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.Dual.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.Dual.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.CFI.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.CFI.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.SIC.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.SIC.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.PIC.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.PIC.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="gvcCentered">@pf.TotalFlightTime.FormatDecimal(viewer.UsesHHMM)<span style="display:none">@pf.TotalFlightTime.ToString(CultureInfo.InvariantCulture)</span></td>
                        <td class="noprint"></td>
                        <td class="noprint"><img src="@("~/images/x.gif".ToAbsolute())" style="padding-right: 10px;" alt="@Resources.LogbookEntry.LogbookDeleteTooltip" title="@Resources.LogbookEntry.LogbookDeleteTooltip" onclick="javascript: deletePendingFlight('@pf.PendingID');" /></td>
                    </tr>
                }
            </tbody>
        </table>
        <p><a href="" style="cursor:pointer" onclick="javascript: deleteAllPendingFlights();">@Resources.LogbookEntry.ReviewPendingFlightsDelete</a></p>
    }
}